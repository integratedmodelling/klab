/**
 * Copyright (C) 2009-2016 integratedmodelling.org
 * generated by Xtext 2.12.0
 */
package org.integratedmodelling.kim.tests;

import com.google.inject.Inject;
import org.eclipse.xtext.testing.InjectWith;
import org.eclipse.xtext.testing.XtextRunner;
import org.eclipse.xtext.testing.util.ParseHelper;
import org.eclipse.xtext.xbase.lib.Exceptions;
import org.eclipse.xtext.xbase.lib.InputOutput;
import org.integratedmodelling.kim.kim.Model;
import org.integratedmodelling.kim.model.Kim;
import org.integratedmodelling.kim.model.KimObservable;
import org.junit.Assert;
import org.junit.Test;
import org.junit.runner.RunWith;

/**
 * 'by' and 'down to' are parsed independently from the remaining declaration.
 */
@RunWith(XtextRunner.class)
@InjectWith(KimInjectorProvider.class)
@SuppressWarnings("all")
public class ByParsingTest {
  @Inject
  private ParseHelper<Model> parseHelper;

  private static String[] testsOK = { "im:Normalized geography:Slope by im:Level", "im:Normalized geography:Slope by im:Level down to im:Moderate" };

  /**
   * Test that parsing the k.IM definition of a normalized declaration
   * produces an identical definition.
   */
  @Test
  public void testReversal() {
    try {
      for (final String test : ByParsingTest.testsOK) {
        {
          final Model result1 = this.parseHelper.parse(test);
          KimObservable observable = Kim.INSTANCE.declareObservable(result1.getObservable());
          final String obstring = observable.toString();
          final Model result2 = this.parseHelper.parse(obstring);
          observable = Kim.INSTANCE.declareObservable(result2.getObservable());
          Assert.assertEquals(observable.toString(), obstring);
        }
      }
    } catch (Throwable _e) {
      throw Exceptions.sneakyThrow(_e);
    }
  }

  @Test
  public void loadModel() {
    try {
      for (final String test : ByParsingTest.testsOK) {
        {
          final Model result = this.parseHelper.parse(test);
          final KimObservable observable = Kim.INSTANCE.declareObservable(result.getObservable());
          Assert.assertNotNull(observable);
          InputOutput.<String>println(observable.getDefinition());
        }
      }
    } catch (Throwable _e) {
      throw Exceptions.sneakyThrow(_e);
    }
  }

  public boolean isEquivalent(final String d1, final String d2) {
    try {
      final KimObservable obs1 = Kim.INSTANCE.declareObservable(this.parseHelper.parse(d1).getObservable());
      final KimObservable obs2 = Kim.INSTANCE.declareObservable(this.parseHelper.parse(d2).getObservable());
      return obs1.equals(obs2);
    } catch (Throwable _e) {
      throw Exceptions.sneakyThrow(_e);
    }
  }
}
